# データベースマイグレーション手順

## 既存テーブル構造について

既存の`profiles`テーブルは以下の特徴があります：
- `id`は`auth.users`のIDを参照（Supabase Authと統合）
- `role`はENUM型（'super_admin', 'org_admin', 'user'）

## マイグレーションSQLの実行

`database_migration.sql`をSupabase SQL Editorで実行してください。
このSQLは既存のテーブル構造を壊さずに、必要なカラムを追加します。

## 重要な注意点

### 1. roleの値の変換が必要

既存のデータベースでは`role`はENUM型で以下の値を使用：
- `'super_admin'`
- `'org_admin'`
- `'user'`

コードでは以下の値を使用：
- `'SUPER_ADMIN'`
- `'ORG_ADMIN'`
- `'USER'`

**対応方法：**
- オプションA: データベースのENUM値をコードに合わせる（推奨しない、既存データに影響）
- オプションB: コード側で変換処理を追加（推奨）

### 2. profilesテーブルのidについて

既存の`profiles`テーブルは`auth.users`のIDを参照していますが、
現在のコードは独立したユーザー管理を想定しています。

**現在の実装では：**
- `id`を自動生成（`gen_random_uuid()`）
- `auth.users`とは独立

**対応方法：**
- オプションA: コードを既存構造に合わせて修正（Supabase Authを使用）
- オプションB: 既存テーブル構造を変更（リスクが高い）

## 推奨される対応

現時点では、マイグレーションSQLを実行して必要なカラムを追加し、
コード側でroleの変換処理を追加することを推奨します。

ただし、`id`の扱いについては、既存の`auth.users`参照を維持するか、
独立したユーザー管理に変更するか、設計を決定する必要があります。
